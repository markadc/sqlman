# SQLMan V2 æµ‹è¯•æ–‡æ¡£

è¿™ä¸ªç›®å½•åŒ…å«äº† SQLMan V2 ç‰ˆæœ¬çš„å®Œæ•´æµ‹è¯•å¥—ä»¶ã€‚

## ğŸ“ æµ‹è¯•æ–‡ä»¶è¯´æ˜

### 1. `test_v2_complete.py` - å®Œæ•´åŠŸèƒ½æµ‹è¯•

**æœ€å…¨é¢çš„æµ‹è¯•å¥—ä»¶**ï¼Œæ¶µç›–æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½ï¼š

- âœ… MySQL ç±»æµ‹è¯•

  - æ•°æ®åº“è¿æ¥ï¼ˆå­—å…¸ã€URL æ–¹å¼ï¼‰
  - è·å–è¡¨åˆ—è¡¨
  - åˆ›å»º/åˆ é™¤æµ‹è¯•è¡¨
  - è·å–è¡¨å¯¹è±¡

- âœ… Table ç±»æµ‹è¯•
  - **æŸ¥è¯¢åŠŸèƒ½**ï¼šåŸºæœ¬æŸ¥è¯¢ã€IN æŸ¥è¯¢ã€æ¡ä»¶æŸ¥è¯¢ã€éšæœºæŸ¥è¯¢
  - **æ’å…¥åŠŸèƒ½**ï¼šå•æ¡æ’å…¥ã€æ‰¹é‡æ’å…¥ã€å†²çªå¤„ç†ã€å»é‡æ’å…¥
  - **æ›´æ–°åŠŸèƒ½**ï¼šåŸºæœ¬æ›´æ–°ã€update_oneã€update_manyã€update_some
  - **åˆ é™¤åŠŸèƒ½**ï¼šå•æ¡åˆ é™¤ã€æ‰¹é‡åˆ é™¤ã€æ¡ä»¶åˆ é™¤
  - **é«˜çº§åŠŸèƒ½**ï¼šscan æ‰«æã€exists æ£€æŸ¥ã€cvs å€¼æ£€æŸ¥ã€min/max è·å–

**è¿è¡Œæ–¹å¼ï¼š**

```bash
python -m sqlman.tests.test_v2_complete.py
```

### 2. `test_v2_quick.py` - å¿«é€Ÿæµ‹è¯•

**è½»é‡çº§æµ‹è¯•**ï¼Œå¿«é€ŸéªŒè¯æ ¸å¿ƒåŠŸèƒ½æ˜¯å¦æ­£å¸¸ï¼š

- è¿æ¥æ•°æ®åº“
- åˆ›å»ºæµ‹è¯•è¡¨
- åŸºæœ¬å¢åˆ æ”¹æŸ¥
- æ¸…ç†æµ‹è¯•æ•°æ®

**é€‚ç”¨åœºæ™¯ï¼š**

- å¿«é€ŸéªŒè¯ç¯å¢ƒé…ç½®
- å¼€å‘è¿‡ç¨‹ä¸­çš„å†’çƒŸæµ‹è¯•
- CI/CD å¿«é€Ÿæ£€æŸ¥

**è¿è¡Œæ–¹å¼ï¼š**

```bash
python -m sqlman.tests.test_v2_quick.py
```

### 3. `test_v2_performance.py` - æ€§èƒ½æµ‹è¯•

**å‹åŠ›æµ‹è¯•**ï¼Œè¯„ä¼°å¤§æ•°æ®é‡åœºæ™¯ä¸‹çš„æ€§èƒ½ï¼š

- æ‰¹é‡æ’å…¥æ€§èƒ½ï¼ˆ10/100/500/1000 æ¡ï¼‰
- æ‰¹é‡æ›´æ–°æ€§èƒ½ï¼ˆupdate_many vs update_someï¼‰
- æŸ¥è¯¢æ€§èƒ½ï¼ˆä¸åŒ limit å€¼ï¼‰
- scan æ‰«æå…¨è¡¨æ€§èƒ½
- å»é‡æ’å…¥æ€§èƒ½

**è¿è¡Œæ–¹å¼ï¼š**

```bash
python -m sqlman.tests.test_v2_performance.py
```

**è¾“å‡ºç¤ºä¾‹ï¼š**

```
æ’å…¥  100 æ¡ï¼šè€—æ—¶ 0.123sï¼Œé€Ÿåº¦ 813 æ¡/ç§’
æ’å…¥  500 æ¡ï¼šè€—æ—¶ 0.456sï¼Œé€Ÿåº¦ 1096 æ¡/ç§’
æ’å…¥ 1000 æ¡ï¼šè€—æ—¶ 0.789sï¼Œé€Ÿåº¦ 1268 æ¡/ç§’
```

### 4. `test_v2_edge_cases.py` - è¾¹ç•Œæƒ…å†µæµ‹è¯•

**å¼‚å¸¸åœºæ™¯æµ‹è¯•**ï¼Œç¡®ä¿ç¨‹åºå¥å£®æ€§ï¼š

- ç©ºæŸ¥è¯¢ç»“æœå¤„ç†
- ç‰¹æ®Šå­—ç¬¦ï¼ˆå•å¼•å·ã€ä¸­æ–‡ã€emojiï¼‰
- NULL å€¼å¤„ç†
- ç©ºåˆ—è¡¨æ“ä½œ
- å¤§æ•°å­—ã€é•¿å­—ç¬¦ä¸²
- ä¸å­˜åœ¨æ•°æ®çš„æ“ä½œ
- å¤æ‚æŸ¥è¯¢æ¡ä»¶

**è¿è¡Œæ–¹å¼ï¼š**

```bash
python -m sqlman.tests.test_v2_edge_cases.py
```

### 5. `test_config_example.py` - é…ç½®ç¤ºä¾‹

æµ‹è¯•é…ç½®æ–‡ä»¶æ¨¡æ¿ï¼ŒåŒ…å«æ•°æ®åº“è¿æ¥ç­‰é…ç½®ã€‚

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å‡†å¤‡ç¯å¢ƒ

**å®‰è£…ä¾èµ–ï¼š**

```bash
pip install DBUtils PyMySQL Faker loguru
```

**æˆ–è€…å®‰è£… sqlmanï¼š**

```bash
pip install sqlman
```

### 2. é…ç½®æ•°æ®åº“ â­

**åˆ›å»ºæµ‹è¯•æ•°æ®åº“ï¼š**

```sql
CREATE DATABASE test DEFAULT CHARSET=utf8mb4;
```

**ä¿®æ”¹é…ç½®ï¼ˆåªéœ€ä¿®æ”¹ä¸€æ¬¡ï¼ï¼‰ï¼š**

æ‰“å¼€ `sqlman/tests/test_config.py` æ–‡ä»¶ï¼Œä¿®æ”¹æ•°æ®åº“è¿æ¥ä¿¡æ¯ï¼š

```python
# MySQL è¿æ¥é…ç½®
MYSQL_CONFIG = {
    'host': 'localhost',
    'port': 3306,
    'username': 'root',
    'password': 'your_password',  # â† ä¿®æ”¹è¿™é‡Œ
    'db': 'test'                  # â† ä¿®æ”¹è¿™é‡Œ
}
```

**âœ… å®Œæˆï¼æ‰€æœ‰æµ‹è¯•æ–‡ä»¶éƒ½ä¼šä½¿ç”¨è¿™ä¸ªé…ç½®ï¼Œæ— éœ€åœ¨æ¯ä¸ªæ–‡ä»¶ä¸­é‡å¤é…ç½®ã€‚**

> ğŸ’¡ æç¤ºï¼š
>
> - `test_config.py` æ˜¯å®é™…ä½¿ç”¨çš„é…ç½®æ–‡ä»¶
> - `test_config_example.py` æ˜¯é…ç½®æ¨¡æ¿ï¼Œä¸è¦ä¿®æ”¹
> - `test_config.py` å·²è¢«åŠ å…¥ `.gitignore`ï¼Œä¸ä¼šè¢«æäº¤åˆ° git

### 3. è¿è¡Œæµ‹è¯•

**è¿è¡Œå•ä¸ªæµ‹è¯•ï¼š**

```bash
# å¿«é€Ÿæµ‹è¯•
python -m sqlman.tests.test_v2_quick.py

# å®Œæ•´æµ‹è¯•
python -m sqlman.tests.test_v2_complete.py

# æ€§èƒ½æµ‹è¯•
python -m sqlman.tests.test_v2_performance.py

# è¾¹ç•Œæµ‹è¯•
python -m sqlman.tests.test_v2_edge_cases.py
```

**è¿è¡Œæ‰€æœ‰æµ‹è¯•ï¼š**

```bash
cd sqlman/tests
python test_v2_quick.py && \
python test_v2_complete.py && \
python test_v2_performance.py && \
python test_v2_edge_cases.py
```

## ğŸ“Š æµ‹è¯•è¦†ç›–ç‡

### MySQL ç±»ï¼ˆdb.pyï¼‰

- âœ… `__init__` - æ•°æ®åº“è¿æ¥åˆå§‹åŒ–
- âœ… `from_url` - URL è¿æ¥æ–¹å¼
- âœ… `__getitem__` - ç´¢å¼•æ–¹å¼è·å–è¡¨
- âœ… `pick_table` - æ–¹æ³•æ–¹å¼è·å–è¡¨
- âœ… `exe_sql` - æ‰§è¡Œ SQL
- âœ… `exem_sql` - æ‰¹é‡æ‰§è¡Œ SQL
- âœ… `get_tables` - è·å–è¡¨åˆ—è¡¨
- âœ… `remove_table` - åˆ é™¤è¡¨
- âœ… `gen_test_table` - ç”Ÿæˆæµ‹è¯•è¡¨

### Table ç±»ï¼ˆtable.pyï¼‰

- âœ… `insert_data` - æ’å…¥æ•°æ®ï¼ˆå•æ¡/æ‰¹é‡ï¼‰
- âœ… `dedup_insert_data` - å»é‡æ’å…¥
- âœ… `delete` - åˆ é™¤æ•°æ®
- âœ… `update` - åŸºæœ¬æ›´æ–°
- âœ… `update_one` - å•æ¡æ›´æ–°
- âœ… `update_many` - æ‰¹é‡æ›´æ–°ï¼ˆå¤šæ¡ SQLï¼‰
- âœ… `update_some` - æ‰¹é‡æ›´æ–°ï¼ˆä¸€æ¡ SQLï¼‰
- âœ… `query` - æŸ¥è¯¢æ•°æ®
- âœ… `query_count` - æŸ¥è¯¢æ•°é‡
- âœ… `exists` - æ£€æŸ¥å­˜åœ¨æ€§
- âœ… `random` - éšæœºæŸ¥è¯¢
- âœ… `get_min` - è·å–æœ€å°å€¼
- âœ… `get_max` - è·å–æœ€å¤§å€¼
- âœ… `scan` - æ‰«æéå†
- âœ… `cvs` - æ£€æŸ¥å€¼å­˜åœ¨æ€§
- âœ… `remove` - åˆ é™¤è¡¨

## ğŸ¯ æµ‹è¯•ç­–ç•¥å»ºè®®

### å¼€å‘é˜¶æ®µ

1. **åŠŸèƒ½å¼€å‘å**ï¼šè¿è¡Œ `test_v2_quick.py` å¿«é€ŸéªŒè¯
2. **æäº¤ä»£ç å‰**ï¼šè¿è¡Œ `test_v2_complete.py` å…¨é¢æµ‹è¯•
3. **æ€§èƒ½ä¼˜åŒ–**ï¼šè¿è¡Œ `test_v2_performance.py` å¯¹æ¯”æ€§èƒ½

### ä¸Šçº¿å‰

1. è¿è¡Œæ‰€æœ‰æµ‹è¯•
2. æ£€æŸ¥æ€§èƒ½æŒ‡æ ‡
3. éªŒè¯è¾¹ç•Œæƒ…å†µ

### CI/CD é›†æˆ

```yaml
# GitHub Actions ç¤ºä¾‹
- name: Run Tests
  run: |
    python -m sqlman.tests.test_v2_quick.py
    python -m sqlman.tests.test_v2_complete.py
```

## ğŸ“ è‡ªå®šä¹‰æµ‹è¯•

### åˆ›å»ºè‡ªå·±çš„æµ‹è¯•

```python
import sys
from pathlib import Path
sys.path.insert(0, str(Path(__file__).parent.parent))

from sqlman.core.v2 import MySQL

# è¿æ¥æ•°æ®åº“
db = MySQL(
    host='localhost',
    port=3306,
    username='root',
    password='your_password',
    db='test_sqlman'
)

# åˆ›å»ºæµ‹è¯•è¡¨
table = db.gen_test_table('my_test', once=100, total=500)

# æ‰§è¡Œä½ çš„æµ‹è¯•
result = table.query(limit=10)
print(f"æŸ¥è¯¢ç»“æœï¼š{len(result)} æ¡")

# æ¸…ç†
db.remove_table('my_test')
```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **æµ‹è¯•æ•°æ®åº“**ï¼šè¯·ä½¿ç”¨ä¸“é—¨çš„æµ‹è¯•æ•°æ®åº“ï¼Œä¸è¦ç”¨ç”Ÿäº§æ•°æ®åº“
2. **æ•°æ®æ¸…ç†**ï¼šæµ‹è¯•ä¼šè‡ªåŠ¨æ¸…ç†åˆ›å»ºçš„æµ‹è¯•è¡¨
3. **å¹¶å‘æµ‹è¯•**ï¼šé¿å…åŒæ—¶è¿è¡Œå¤šä¸ªæµ‹è¯•ï¼Œå¯èƒ½å¯¼è‡´è¡¨åå†²çª
4. **ç½‘ç»œå»¶è¿Ÿ**ï¼šæ€§èƒ½æµ‹è¯•ç»“æœä¼šå—ç½‘ç»œå½±å“ï¼Œå»ºè®®æœ¬åœ°æµ‹è¯•

## ğŸ› å¸¸è§é—®é¢˜

### Q1: è¿æ¥å¤±è´¥

```
âŒ è¿æ¥å¤±è´¥ï¼š(2003, "Can't connect to MySQL server...")
```

**è§£å†³æ–¹æ¡ˆï¼š**

- æ£€æŸ¥ MySQL æœåŠ¡æ˜¯å¦å¯åŠ¨
- ç¡®è®¤è¿æ¥ä¿¡æ¯æ˜¯å¦æ­£ç¡®
- æ£€æŸ¥é˜²ç«å¢™è®¾ç½®

### Q2: è¡¨å·²å­˜åœ¨

```
âŒ è¡¨æ ¼åˆ›å»ºå¤±è´¥
```

**è§£å†³æ–¹æ¡ˆï¼š**

- æ‰‹åŠ¨åˆ é™¤æµ‹è¯•è¡¨
- æˆ–è€…ä¿®æ”¹æµ‹è¯•è¡¨å

### Q3: æƒé™ä¸è¶³

```
âŒ (1142, "INSERT command denied...")
```

**è§£å†³æ–¹æ¡ˆï¼š**

- ç¡®ä¿æ•°æ®åº“ç”¨æˆ·æœ‰è¶³å¤Ÿæƒé™
- æˆäºˆæƒé™ï¼š`GRANT ALL PRIVILEGES ON test_sqlman.* TO 'root'@'localhost';`

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [é¡¹ç›® README](../README.md)
- [sqlman æ–‡æ¡£](../sqlman/README.md)
- [æºç ï¼šdb.py](../sqlman/core/v2/db.py)
- [æºç ï¼štable.py](../sqlman/core/v2/table.py)

## ğŸ¤ è´¡çŒ®æµ‹è¯•ç”¨ä¾‹

æ¬¢è¿æäº¤æ–°çš„æµ‹è¯•ç”¨ä¾‹ï¼è¯·ç¡®ä¿ï¼š

1. æµ‹è¯•ä»£ç æ¸…æ™°æ˜“æ‡‚
2. åŒ…å«å¿…è¦çš„æ³¨é‡Š
3. èƒ½å¤Ÿç‹¬ç«‹è¿è¡Œ
4. è‡ªåŠ¨æ¸…ç†æµ‹è¯•æ•°æ®

---

**ä½œè€…ï¼š** WangTuo  
**é¡¹ç›®ï¼š** [https://github.com/markadc/sqlman](https://github.com/markadc/sqlman)
